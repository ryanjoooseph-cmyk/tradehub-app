{
  "version": 1,
  "defaults": {
    "branchPrefix": "agent",
    "openPr": true,
    "labels": ["automerge"],
    "mergeStrategy": "squash",
    "maxOpenPRs": 6,
    "guard": {
      "allow": ["app/**", "agents/**"],
      "deny": [
        ".github/**",
        "package*.json",
        "pnpm-lock.yaml",
        "yarn.lock",
        "next.config.*",
        "tsconfig*.json",
        "public/**",
        "node_modules/**",
        "supabase/**",
        "prisma/**",
        "lib/**"
      ]
    },
    "commitMessageTemplate": "chore(agent): {{title}}",
    "prTitleTemplate": "{{id}}",
    "prBodyTemplate": "Automated PR for {{title}}"
  },
  "tasks": [
    {
      "id": "auth_gate_001",
      "title": "Add client-only AuthGate and wire into layout",
      "changes": [
        {
          "path": "app/(components)/AuthGate.tsx",
          "action": "write",
          "content": "/* eslint-disable */\n\"use client\";\nimport { useEffect, useState } from \"react\";\nimport { usePathname, useRouter } from \"next/navigation\";\n\nconst PUBLIC = new Set([\"/\", \"/login\", \"/register\", \"/not-found\"]);\n\nexport default function AuthGate({ children }: { children: React.ReactNode }) {\n  const pathname = usePathname() ?? \"/\";\n  const router = useRouter();\n  const [ready, setReady] = useState(false);\n\n  useEffect(() => {\n    if (PUBLIC.has(pathname)) { setReady(true); return; }\n    const token = typeof window !== \"undefined\" ? localStorage.getItem(\"th_auth\") : null;\n    if (!token) { router.replace(\"/login\"); return; }\n    setReady(true);\n  }, [pathname, router]);\n\n  if (!ready) return null;\n  return <>{children}</>;\n}\n"
        },
        {
          "path": "app/layout.tsx",
          "action": "write",
          "content": "/* eslint-disable */\nimport \"./globals.css\";\nimport Link from \"next/link\";\nimport AuthGate from \"./(components)/AuthGate\";\n\nexport const metadata = { title: \"TradeHub\" };\n\nexport default function RootLayout({ children }: { children: React.ReactNode }) {\n  return (\n    <html lang=\"en\">\n      <body>\n        <header style={{padding:\"12px 16px\",borderBottom:\"1px solid #eee\"}}>\n          <nav style={{display:\"flex\",gap:12}}>\n            <Link href=\"/\">Home</Link>\n            <Link href=\"/dashboard\">Dashboard</Link>\n            <Link href=\"/clients\">Clients</Link>\n            <Link href=\"/jobs\">Jobs</Link>\n            <Link href=\"/quotes\">Quotes</Link>\n          </nav>\n        </header>\n        <AuthGate>{children}</AuthGate>\n      </body>\n    </html>\n  );\n}\n"
        }
      ]
    },
    {
      "id": "auth_login_page_001",
      "title": "Create public /login page (stub auth)",
      "changes": [
        {
          "path": "app/login/page.tsx",
          "action": "write",
          "content": "/* eslint-disable */\n\"use client\";\nimport { useRouter } from \"next/navigation\";\nimport { useState } from \"react\";\n\nexport default function LoginPage(){\n  const r = useRouter();\n  const [email,setEmail] = useState(\"\");\n  const [password,setPassword] = useState(\"\");\n  const onSubmit = (e: React.FormEvent) => { e.preventDefault(); localStorage.setItem(\"th_auth\",\"ok\"); r.replace(\"/dashboard\"); };\n  return (\n    <main style={{maxWidth:480, margin:\"40px auto\", fontFamily:\"system-ui, sans-serif\"}}>\n      <h1>Sign in</h1>\n      <p style={{color:\"#666\"}}>This is a public page. AuthGate will not run here.</p>\n      <form onSubmit={onSubmit} style={{display:\"grid\", gap:12, marginTop:16}}>\n        <label>Email<input value={email} onChange={e=>setEmail(e.target.value)} placeholder=\"you@example.com\" required /></label>\n        <label>Password<input type=\"password\" value={password} onChange={e=>setPassword(e.target.value)} required /></label>\n        <button type=\"submit\">Continue</button>\n      </form>\n      <p style={{marginTop:12}}><a href=\"/register\">No account? Create one</a></p>\n    </main>\n  );\n}\n"
        }
      ]
    },
    {
      "id": "ui_shell_dashboard_001",
      "title": "Scaffold /dashboard page",
      "changes": [
        {
          "path": "app/dashboard/page.tsx",
          "action": "write",
          "content": "export default function Page(){return (<main style={{padding:24}}><h1>TradeHub Dashboard</h1><p>Scaffolded: ui_shell_dashboard_001</p></main>);}\n"
        }
      ]
    },
    {
      "id": "ui_shell_clients_001",
      "title": "Scaffold /clients page",
      "changes": [
        {
          "path": "app/clients/page.tsx",
          "action": "write",
          "content": "export default function Page(){return (<main style={{padding:24}}><h1>Clients</h1><p>Scaffolded: ui_shell_clients_001</p></main>);}\n"
        }
      ]
    },
    {
      "id": "ui_shell_jobs_001",
      "title": "Scaffold /jobs page",
      "changes": [
        {
          "path": "app/jobs/page.tsx",
          "action": "write",
          "content": "export default function Page(){return (<main style={{padding:24}}><h1>Jobs</h1><p>Scaffolded: ui_shell_jobs_001</p></main>);}\n"
        }
      ]
    },
    {
      "id": "ui_shell_quotes_001",
      "title": "Scaffold /quotes page",
      "changes": [
        {
          "path": "app/quotes/page.tsx",
          "action": "write",
          "content": "export default function Page(){return (<main style={{padding:24}}><h1>Quotes</h1><p>Scaffolded: ui_shell_quotes_001</p></main>);}\n"
        }
      ]
    },
    {
      "id": "not_found_001",
      "title": "Keep reserved /not-found page server-safe",
      "changes": [
        {
          "path": "app/not-found.tsx",
          "action": "write",
          "content": "export default function NotFound(){return (<main style={{padding:24}}><h1>Page not found</h1><p>Sorry, we couldn't find that page.</p><p><a href=\"/\">Go back home</a></p></main>);}\n"
        }
      ]
    },
    {
      "id": "api_jobs_routes_001",
      "title": "Create Jobs API (GET/POST, GET/PUT/DELETE by id)",
      "changes": [
        {
          "path": "app/api/jobs/route.ts",
          "action": "write",
          "content": "/* eslint-disable */\nimport { NextRequest, NextResponse } from \"next/server\";\nconst g:any = globalThis as any; g.__JOBS__ = g.__JOBS__ ?? [];\nconst JOBS:any[] = g.__JOBS__;\nexport async function GET(_req: NextRequest){ return NextResponse.json({ jobs: JOBS }); }\nexport async function POST(req: NextRequest){ const body = await req.json(); const job = { id: String(Date.now()), ...body }; JOBS.push(job); return NextResponse.json({ job }, { status: 201 }); }\n"
        },
        {
          "path": "app/api/jobs/[id]/route.ts",
          "action": "write",
          "content": "/* eslint-disable */\nimport { NextRequest, NextResponse } from \"next/server\";\nconst g:any = globalThis as any; g.__JOBS__ = g.__JOBS__ ?? [];\nconst JOBS:any[] = g.__JOBS__;\nexport async function GET(_req: NextRequest, ctx: { params: { id: string } }){ const j = JOBS.find(x=>x.id===ctx.params.id); return j ? NextResponse.json({ job:j }) : NextResponse.json({ error:\"not found\" }, { status:404 }); }\nexport async function PUT(req: NextRequest, ctx: { params: { id: string } }){ const i = JOBS.findIndex(x=>x.id===ctx.params.id); if(i<0) return NextResponse.json({ error:\"not found\" }, { status:404 }); const patch = await req.json(); JOBS[i] = { ...JOBS[i], ...patch }; return NextResponse.json({ job:JOBS[i] }); }\nexport async function DELETE(_req: NextRequest, ctx: { params: { id: string } }){ const i = JOBS.findIndex(x=>x.id===ctx.params.id); if(i<0) return NextResponse.json({ ok:false }, { status:404 }); const [removed] = JOBS.splice(i,1); return NextResponse.json({ ok:true, job:removed }); }\n"
        }
      ]
    },
    {
      "id": "api_quotes_routes_001",
      "title": "Create Quotes API (GET/POST, GET/PATCH/DELETE by id)",
      "changes": [
        {
          "path": "app/api/quotes/route.ts",
          "action": "write",
          "content": "/* eslint-disable */\nimport { NextRequest, NextResponse } from \"next/server\";\nconst g:any = globalThis as any; g.__QUOTES__ = g.__QUOTES__ ?? [];\nconst QUOTES:any[] = g.__QUOTES__;\nexport async function GET(_req: NextRequest){ return NextResponse.json({ quotes: QUOTES }); }\nexport async function POST(req: NextRequest){ const body = await req.json(); const quote = { id: String(Date.now()), ...body }; QUOTES.push(quote); return NextResponse.json({ quote }, { status: 201 }); }\n"
        },
        {
          "path": "app/api/quotes/[id]/route.ts",
          "action": "write",
          "content": "/* eslint-disable */\nimport { NextRequest, NextResponse } from \"next/server\";\nconst g:any = globalThis as any; g.__QUOTES__ = g.__QUOTES__ ?? [];\nconst QUOTES:any[] = g.__QUOTES__;\nexport async function GET(_req: NextRequest, ctx: { params: { id: string } }){ const q = QUOTES.find(x=>x.id===ctx.params.id); return q ? NextResponse.json({ quote:q }) : NextResponse.json({ error:\"not found\" }, { status:404 }); }\nexport async function PATCH(req: NextRequest, ctx: { params: { id: string } }){ const i = QUOTES.findIndex(x=>x.id===ctx.params.id); if(i<0) return NextResponse.json({ error:\"not found\" }, { status:404 }); const patch = await req.json(); QUOTES[i] = { ...QUOTES[i], ...patch }; return NextResponse.json({ quote:QUOTES[i] }); }\nexport async function DELETE(_req: NextRequest, ctx: { params: { id: string } }){ const i = QUOTES.findIndex(x=>x.id===ctx.params.id); if(i<0) return NextResponse.json({ ok:false }, { status:404 }); const [removed] = QUOTES.splice(i,1); return NextResponse.json({ ok:true, quote:removed }); }\n"
        }
      ]
    },
    {
      "id": "ui_nav_hint_001",
      "title": "Add simple top nav (if missing)",
      "changes": [
        {
          "path": "app/(components)/NavHint.md",
          "action": "write",
          "content": "Top nav lives in app/layout.tsx. Links: /dashboard, /clients, /jobs, /quotes.\n"
        }
      ]
    }
  ]
}
